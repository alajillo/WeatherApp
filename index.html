<html>
  <head>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    ;
    <link rel="stylesheet" href="index.css" />
  </head>
  <body>
    <div class="top">
      <div class="top-box_1">
        <div id="cityName"></div>
        <select
          class="locations"
          name="location"
          id="location"
          onchange="getWeather()"
        >
          <option value="null">도시</option>
          <option value="Seoul">서울</option>
          <option value="Busan">부산</option>
          <option value="Gangwon-do">강원도</option>
          <option value="Incheon">인천</option>
          <option value="Jeju-do">제주도</option>
        </select>
        <div id="weather-now">날씨 개요</div>
      </div>
      <div class="temperature">
        <div class="temperature-now" id="temp">현재 기온</div>
        <div class="temperature-sub">
          <div id="temperature-sub-high">최고 기온</div>
          <div id="temperature-sub-low">최저 기온</div>
        </div>
      </div>
    </div>

    <div class="middle"></div>
    <div class="bottom"></div>
    <div class="footer"></div>
  </body>
  <script>
    function getWeather() {
      var city = document.getElementById("location").value;
      const weather_api_url = `https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=4977c6395d6461c4d67ac01827948fe7&lang=kr`;
      document.getElementById("cityName").innerHTML = city;
      document.getElementById("location").style.display = "none";
      document.getElementById("cityName").style.display = "flex";
      if (city === "Seoul") {
        var cityLon = 127.0;
        var cityLat = 37.583328;
      } else if (city === "Busan") {
        var cityLon = 129.050003;
        var cityLat = 35.133331;
      } else if (city === "Gangwon-do") {
        var cityLon = 128.25;
        var cityLat = 37.75;
      } else if (city === "Incheon") {
        var cityLon = 126.416107;
        var cityLat = 37.450001;
      } else if (city === "Jeju-do") {
        var cityLon = 126.5;
        var cityLat = 33.416672;
      }
      const forecast_url = `https://api.openweathermap.org/data/2.5/onecall?lat=${cityLat}&lon=${cityLon}&exclude=daily&appid=4977c6395d6461c4d67ac01827948fe7`;

      axios
        .get(weather_api_url)
        .then(function (result) {
          console.log("통신결과 :", result);
          temp = result.data.main.temp - 273.15;
          weather = result.data.weather[0].description;
          tempLow = result.data.main.temp_min - 273.15;
          tempHigh = result.data.main.temp_max - 273.15;

          document.getElementById("temp").innerHTML = temp.toFixed(2);
          document.getElementById("weather-now").innerHTML = weather;
          document.getElementById(
            "temperature-sub-high"
          ).innerHTML = `최저기온 \n ${tempLow.toFixed(2)}`;
          document.getElementById(
            "temperature-sub-low"
          ).innerHTML = `최고기온 \n ${tempHigh.toFixed(2)}`;
        })
        .catch(function (error) {
          console.error("error 발생 :", error);
        });

      axios
        .get(forecast_url)
        .then(function (result) {
          console.log("통신결과 :", result);
          var fore_weather = [];
          var fore_temp = [];
          for (i = 0; i < 24; i++) {
            fore_temp[i] = result.data.hourly[i].temp - 273.15;
            fore_temp[i] = fore_temp[i].toFixed(2);
            fore_weather[i] = result.data.hourly[i].weather[0].main;
          }
          var fore_card = "";
          console.log(fore_temp);
          console.log(fore_weather);
          for (i = 0; i < 24; i++) {
            fore_card += `<div class="hourly-forecast">
        <p>${i}시간후</p>
        <div></div>
        <div>${fore_temp[i]}도</div>
      </div>`;
          }
          document.querySelector(".middle").innerHTML = fore_card;
        })
        .catch(function (error) {
          console.error("error 발생 :", error);
        });
    }
  </script>
</html>
